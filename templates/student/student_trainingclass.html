{% include "student/header.html" %}
{% load static %}

<!-- Page Content -->
<section class="section-hero overlay inner-page bg-image" style="background-image: url('{% static 'guest/assets/images/hero_1.jpg' %}'); margin-top: -20px; padding-top: 100px; padding-bottom: 50px;">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1 class="text-white font-weight-bold">My Training Classes</h1>
        <div class="custom-breadcrumbs">
          <a href="{% url 'student_home' %}">Dashboard</a> <span class="mx-2 slash">/</span>
          <span class="text-white"><strong>Training Classes</strong></span>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="site-section">
  <div class="container">
    <!-- Statistics Cards -->
    <div class="row mb-5">
      <div class="col-md-4 mb-4">
        <div class="card text-center border-0 shadow-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
          <div class="card-body py-4">
            <h2 class="display-4 mb-2">{{ total_classes }}</h2>
            <h5 class="card-title">Total Classes</h5>
            <p class="mb-0">All scheduled classes</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-4 mb-4">
        <div class="card text-center border-0 shadow-lg" style="background: linear-gradient(135deg, #1cc88a 0%, #17a673 100%); color: white;">
          <div class="card-body py-4">
            <h2 class="display-4 mb-2">{{ upcoming_count }}</h2>
            <h5 class="card-title">Upcoming</h5>
            <p class="mb-0">Future classes</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-4 mb-4">
        <div class="card text-center border-0 shadow-lg" style="background: linear-gradient(135deg, #36b9cc 0%, #258391 100%); color: white;">
          <div class="card-body py-4">
            <h2 class="display-4 mb-2">{{ completed_count }}</h2>
            <h5 class="card-title">Completed</h5>
            <p class="mb-0">Past classes</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Filters and Search -->
    <div class="row mb-4">
      <div class="col-md-8">
        <div class="btn-group" role="group">
          <a href="?status=all" class="btn {% if status_filter == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            <i class="fas fa-list"></i> All Classes
          </a>
          <a href="?status=upcoming" class="btn {% if status_filter == 'upcoming' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            <i class="fas fa-clock"></i> Upcoming
          </a>
          <a href="?status=past" class="btn {% if status_filter == 'past' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            <i class="fas fa-history"></i> Completed
          </a>
        </div>
      </div>
      
      <div class="col-md-4">
        <form method="GET" class="form-inline">
          <div class="input-group">
            <input type="text" class="form-control" name="search" placeholder="Search classes..." value="{{ search_query }}">
            <div class="input-group-append">
              <button class="btn btn-primary" type="submit">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Student Info -->
    <div class="row mb-5">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-md-8">
                <h4 class="card-title mb-3">
                  <i class="fas fa-user-graduate text-primary mr-2"></i>
                  {{ student.student_name }}
                </h4>
                <div class="row">
                  <div class="col-md-6">
                    <p class="mb-1"><strong>Course:</strong> {{ student.course_id.course_name }}</p>
                    <p class="mb-1"><strong>Batch:</strong> {{ student.batch_id.batch_year }}</p>
                  </div>
                  <div class="col-md-6">
                    <p class="mb-1"><strong>Email:</strong> {{ student.email }}</p>
                    <p class="mb-0"><strong>Contact:</strong> {{ student.contact_number }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-4 text-right">
                {% if student.photo %}
                  <img src="{{ student.photo.url }}" alt="Profile" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #2c98f0;">
                {% else %}
                  <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center" style="width: 100px; height: 100px; border: 3px solid #2c98f0;">
                    <i class="fas fa-user fa-3x text-muted"></i>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Training Classes -->
    <div class="row">
      {% if training_classes %}
        {% for class in training_classes %}
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 shadow-sm border-{% if class.date >= today %}success{% else %}secondary{% endif %}">
              <div class="card-header bg-{% if class.date >= today %}success{% else %}secondary{% endif %} text-white">
                <h5 class="card-title mb-0">
                  <i class="fas fa-chalkboard-teacher mr-2"></i>
                  {{ class.trainingclass_name }}
                </h5>
              </div>
              
              <div class="card-body">
                <div class="mb-3">
                  {% if class.date >= today %}
                    <span class="badge badge-success p-2">
                      <i class="fas fa-clock mr-1"></i> Upcoming
                    </span>
                  {% else %}
                    <span class="badge badge-secondary p-2">
                      <i class="fas fa-check-circle mr-1"></i> Completed
                    </span>
                  {% endif %}
                </div>
                
                <div class="class-details">
                  <div class="mb-2">
                    <strong><i class="far fa-calendar text-primary mr-2"></i>Date:</strong>
                    {{ class.date|date:"F d, Y" }}
                  </div>
                  
                  <div class="mb-2">
                    <strong><i class="far fa-clock text-primary mr-2"></i>Time:</strong>
                    {{ class.start_time|time:"h:i A" }}
                  </div>
                  
                  <div class="mb-2">
                    <strong><i class="fas fa-book text-primary mr-2"></i>Course:</strong>
                    {{ class.course_id.course_name }}
                  </div>
                  
                  <div class="mb-2">
                    <strong><i class="fas fa-chalkboard text-primary mr-2"></i>Type:</strong>
                    {{ class.classtype_id.classtype_name }}
                  </div>
                  
                  <div class="mb-3">
                    <strong><i class="fas fa-users text-primary mr-2"></i>Batch:</strong>
                    {{ class.batch_id.batch_year }}
                  </div>
                  
                  {% if class.description %}
                    <div class="class-description mt-3 pt-3 border-top">
                      <strong><i class="fas fa-info-circle text-primary mr-2"></i>Description:</strong>
                      <p class="mt-2 mb-0 text-muted">{{ class.description|truncatechars:100 }}</p>
                    </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="card-footer bg-white">
                {% if class.date >= today %}
                  <button class="btn btn-success btn-sm">
                    <i class="fas fa-calendar-check mr-1"></i> Join Class
                  </button>
                {% endif %}
                <button class="btn btn-outline-primary btn-sm" data-toggle="modal" data-target="#classModal{{ class.trainingclass_id }}">
                  <i class="fas fa-eye mr-1"></i> View Details
                </button>
              </div>
            </div>
          </div>
          
          <!-- Modal for Class Details -->
          <div class="modal fade" id="classModal{{ class.trainingclass_id }}" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                  <h5 class="modal-title">{{ class.trainingclass_name }}</h5>
                  <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-md-6">
                      <p><strong><i class="far fa-calendar mr-2"></i>Date:</strong> {{ class.date|date:"F d, Y" }}</p>
                      <p><strong><i class="far fa-clock mr-2"></i>Time:</strong> {{ class.start_time|time:"h:i A" }}</p>
                      <p><strong><i class="fas fa-book mr-2"></i>Course:</strong> {{ class.course_id.course_name }}</p>
                    </div>
                    <div class="col-md-6">
                      <p><strong><i class="fas fa-chalkboard mr-2"></i>Class Type:</strong> {{ class.classtype_id.classtype_name }}</p>
                      <p><strong><i class="fas fa-users mr-2"></i>Batch:</strong> {{ class.batch_id.batch_year }}</p>
                      <p>
                        <strong><i class="fas fa-info-circle mr-2"></i>Status:</strong>
                        {% if class.date >= today %}
                          <span class="badge badge-success">Upcoming</span>
                        {% else %}
                          <span class="badge badge-secondary">Completed</span>
                        {% endif %}
                      </p>
                    </div>
                  </div>
                  
                  {% if class.description %}
                    <div class="mt-4">
                      <h6><i class="fas fa-align-left mr-2"></i>Description</h6>
                      <div class="p-3 bg-light rounded">
                        {{ class.description|linebreaks }}
                      </div>
                    </div>
                  {% endif %}
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  {% if class.date >= today %}
                    <button class="btn btn-primary">
                      <i class="fas fa-calendar-check mr-1"></i> Add to Calendar
                    </button>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body text-center py-5">
              <i class="fas fa-calendar-times fa-4x text-muted mb-4"></i>
              <h4 class="text-muted mb-3">
                {% if status_filter == 'upcoming' %}
                  No Upcoming Classes
                {% elif status_filter == 'past' %}
                  No Completed Classes
                {% elif search_query %}
                  No classes found for "{{ search_query }}"
                {% else %}
                  No Training Classes Found
                {% endif %}
              </h4>
              <p class="text-muted mb-4">
                {% if status_filter == 'upcoming' %}
                  You don't have any upcoming training classes scheduled.
                {% elif status_filter == 'past' %}
                  You haven't completed any training classes yet.
                {% elif search_query %}
                  Try adjusting your search terms.
                {% else %}
                  No training classes have been scheduled for your course and batch yet.
                {% endif %}
              </p>
              {% if search_query or status_filter != 'all' %}
                <a href="?status=all" class="btn btn-primary">
                  <i class="fas fa-redo mr-1"></i> View All Classes
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</section>

{% include "student/footer.html" %}