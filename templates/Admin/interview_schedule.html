{% load static %}
{% include 'Admin/header.html' %}
<br><br>
<br><br>
<div class="container" style="margin-left:300px;">
  <div class="table_section padding_infor_info">
      <h3>Assign Students</h3>
      
      <!-- Request Details -->
      <div class="card mb-4">
          <div class="card-header bg-info text-white">
              <h5 class="mb-0">Request Details</h5>
          </div>
          <div class="card-body">
              <div class="row">
                  <div class="col-md-6">
                      <p><strong>Request ID:</strong> #{{ student.request_id }}</p>
                      <p><strong>Job Position:</strong> {{ student.jobpost_id.position }}</p>
                      <p><strong>Company:</strong> {{ student.jobpost_id.company_id.company_name }}</p>
                  </div>
                  <div class="col-md-6">
                      <p><strong>Batch:</strong> {{ student.batch_id.batch_year }}</p>
                      <p><strong>Course:</strong> {{ student.course_id.course_name }}</p>
                      <p><strong>Required Students:</strong> {{ student.student_count }}</p>
                  </div>
              </div>
          </div>
      </div>

      <!-- Students List -->
      <div class="card">
          <div class="card-header bg-primary text-white">
              <div class="d-flex justify-content-between align-items-center">
                  <h5 class="mb-0">Available Students</h5>
                  <span class="badge bg-light text-dark">{{ students|length }} students</span>
              </div>
          </div>
          <div class="card-body">
              {% if students %}
              <form method="post" action="{% url 'assign_students' %}">
                  {% csrf_token %}
                  <input type="hidden" name="request_id" value="{{ student.request_id }}">
                  
                  <div class="table-responsive">
                      <table class="table table-bordered table-hover">
                          <thead class="thead-dark">
                              <tr>
                                  <th width="50px">
                                      <input type="checkbox" id="selectAll"> All
                                  </th>
                                  <th>Student ID</th>
                                  <th>Name</th>
                                  <th>Percentage</th>
                                  <th>Email</th>
                                  <th>Phone</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for student_item in students %}
                              <tr>
                                  <td align="center">
                                      <input type="checkbox" name="selected_students" 
                                             value="{{ student_item.student_id }}" class="student-checkbox">
                                  </td>
                                  <td>{{ student_item.student_id }}</td>
                                  <td>{{ student_item.student_name }}</td>
                                  <td>
                                      <span class="badge {% if student_item.percentage >= 60 %}bg-success{% else %}bg-warning{% endif %}">
                                          {{ student_item.percentage|default:"0" }}%
                                      </span>
                                  </td>
                                  <td>{{ student_item.email }}</td>
                                  <td>{{ student_item.contact_number }}</td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                  </div>
                  
                  <div class="mt-4">
                      <button type="submit" class="btn btn-success btn-lg">
                          <i class="fas fa-user-check"></i> Assign Students
                      </button>
                      <a href="{% url 'company_accepted_students' %}" class="btn btn-secondary btn-lg">
                          <i class="fas fa-arrow-left"></i> Back
                      </a>
                  </div>
              </form>
              {% else %}
              <div class="alert alert-warning text-center">
                  <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                  <h5>No Students Available</h5>
                  <p>No students found for batch {{ student.batch_id.batch_year }} and course {{ student.course_id.course_name }}</p>
                  <a href="{% url 'company_accepted_students' %}" class="btn btn-primary">Back</a>
              </div>
              {% endif %}
          </div>
      </div>
  </div>
</div>

<style>
  .table_section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      width: 1200px;
  }
  
  .card {
      border: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .badge {
      font-size: 0.85em;
      padding: 5px 10px;
  }
  
  .student-checkbox {
      transform: scale(1.3);
  }
</style>

<script src="{% static 'jquery-3.7.1.min.js' %}"></script>
<script>
    $(document).ready(function() {
        // Select All functionality
        $('#selectAll').change(function() {
            $('.student-checkbox').prop('checked', $(this).prop('checked'));
        });
        
        // Form submission confirmation
        $('form').submit(function(e) {
            var checkedCount = $('.student-checkbox:checked').length;
            if(checkedCount === 0) {
                alert('Please select at least one student.');
                e.preventDefault();
                return false;
            }
            
            return confirm('Assign ' + checkedCount + ' student(s)?');
        });
    });
</script>
{% include 'Admin/footer.html' %}